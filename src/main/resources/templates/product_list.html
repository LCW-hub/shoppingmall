<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 목록 - 쇼핑몰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
</head>
<body>
    <!-- 고정된 로그아웃 버튼 -->
    <a th:if="${session.user != null}" href="/logout" class="logout-btn-fixed">
        <i class="fas fa-sign-out-alt"></i>로그아웃
    </a>
    
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shopping-bag me-2"></i>쇼핑몰
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i>홈</a>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bars me-1"></i>부품 카테고리
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
                            <li th:each="cat : ${menuCategories}">
                                <a class="dropdown-item" th:href="@{/products(category=${cat})}" th:text="${cat}">카테고리명</a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/products">전체 보기</a></li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/products"><i class="fas fa-box me-1"></i>상품</a>
                    </li>
                    <li class="nav-item" th:if="${session.user != null and session.user.role == 'ADMIN'}">
                        <a class="nav-link" href="/admin/add"><i class="fas fa-plus-circle me-1"></i>상품 추가</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item d-flex align-items-center me-3">
                        <form class="d-flex" method="get" action="/products">
                            <input class="form-control me-2 form-control-sm" type="search" name="keyword" placeholder="상품 검색" aria-label="Search">
                            <button class="btn btn-outline-light btn-sm" type="submit"><i class="fas fa-search"></i></button>
                        </form>
                    </li>
                    <li class="nav-item">
                        <a href="/cart/view" class="nav-link cart-icon">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-count" th:text="${cartCount}">0</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown" th:if="${session.user != null}">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-1"></i>
                            <span th:text="${session.user.name}"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item logout-item" href="/logout">
                                <i class="fas fa-sign-out-alt me-1"></i>로그아웃
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item" th:if="${session.user == null}">
                        <a class="nav-link" href="/login">로그인</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1>PC 부품 전체</h1>
            <p>CPU · 메인보드 · 그래픽카드 · 메모리 · SSD까지 한눈에</p>
        </div>
    </div>

    <div class="container">
        <!-- 검색 결과 표시 -->
        <div th:if="${keyword != null and !keyword.isEmpty()}" class="alert bg-primary text-light border-0 rounded-4 mb-4">
            <div class="d-flex align-items-center">
                <i class="fas fa-search me-3 fs-4"></i>
                <div>
                    <strong>"<span th:text="${keyword}"></span>"</strong> 검색 결과 
                    <span th:text="${products.size()}"></span>개의 상품을 찾았습니다.
                </div>
            </div>
        </div>

        <!-- Filter and Search Section -->
        <div class="filter-section">
            <div class="row g-3 align-items-center">
                <div class="col-md-5">
                    <form method="get" action="/products" class="d-flex gap-2">
                        <select name="category" class="form-select" onchange="this.form.submit()">
                            <option value="">모든 카테고리</option>
                            <option th:each="cat : ${categories}"
                                    th:value="${cat}"
                                    th:text="${cat}"
                                    th:selected="${cat == selectedCategory}">
                                카테고리
                            </option>
                        </select>
                        <!-- <button type="submit" class="btn btn-primary">적용</button> -->
                    </form>
                </div>
                <div class="col-md-7">
                    <form method="get" action="/products" class="d-flex gap-2">
                        <input type="text" name="keyword" class="form-control" placeholder="상품명을 입력하세요" />
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Product List -->
        <div class="row product-row">
            <div class="col-lg-3 col-md-4 col-sm-6" th:each="product : ${products}">
                <div class="product-card">
                    <img th:src="@{${product.imageUrl}}" class="product-image" alt="상품 이미지" />
                    <div class="card-body">
                        <h2 class="product-title" th:text="${product.name}">상품명</h2>
                        <p class="product-price" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'">가격</p>
                        <div class="product-stock">
                            <span th:if="${product.stock > 0}" class="in-stock" th:text="'재고: ' + ${product.stock} + '개'"></span>
                            <span th:unless="${product.stock > 0}" class="out-of-stock">품절</span>
                        </div>
                        <div class="product-actions">
                            <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-primary">
                                <i class="fas fa-eye me-2"></i>상세보기
                            </a>
                            <form th:if="${session.user != null}" th:action="@{/cart/add/{id}(id=${product.id})}" method="post" class="d-inline">
                                <button type="submit" class="btn btn-outline-primary">
                                    <i class="fas fa-cart-plus me-2"></i>장바구니 담기
                                </button>
                            </form>
                            <form th:if="${session.user != null and session.user.role == 'ADMIN'}" th:action="@{/products/edit/{id}(id=${product.id})}" method="get" class="d-inline">
        						<button type="submit" class="btn btn-warning btn-sm me-2">
            						<i class="fas fa-edit me-1"></i>수정
       							 </button>
                            </form>
<form th:action="@{/admin/delete/{id}(id=${product.id})}" method="post" class="d-inline">
    <button type="submit" class="btn btn-danger btn-sm">삭제</button>
</form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 검색 결과가 없을 때 메시지 -->
        <div th:if="${products.isEmpty()}" class="text-center py-5">
            <div class="alert alert-warning text-dark border-0 rounded-4 py-4 px-4">
                <i class="fas fa-search fs-1 mb-3 d-block text-warning"></i>
                <h3>검색 결과가 없습니다</h3>
                <p th:if="${keyword != null and !keyword.isEmpty()}">
                    "<span th:text="${keyword}"></span>"에 대한 검색 결과를 찾을 수 없습니다.<br>
                    다른 키워드로 검색해보세요.
                </p>
                <p th:unless="${keyword != null and !keyword.isEmpty()}">
                    현재 등록된 상품이 없습니다.
                </p>
                <a href="/products" class="btn btn-light mt-3 rounded-pill px-4 py-2">
                    <i class="fas fa-home me-2"></i>전체 상품 보기
                </a>
            </div>
        </div>
        
        <!-- Pagination (if needed) -->
        <div class="pagination">
            <!-- Pagination links here -->
        </div>
    </div>

    <!-- Footer can be added here -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

